{"id":"imagen-03l","title":"Add Analysis Session Workflow section to PROMPT.md","design":"Edit PROMPT.md: Add new section '## Analysis Session Workflow' after Rule C that specifies: (1) Turn 1 MUST batch Bash(session analysis python3) + Bash(blacksmith improve list) + Read PROMPT.md as THREE parallel calls; (2) All blacksmith improve add calls MUST be ONE parallel turn; (3) All bd create calls MUST be ONE parallel turn; (4) Never run multiple incremental python3 scripts on the same .jsonl file across separate turns.","status":"open","priority":1,"issue_type":"chore","owner":"shout@ozten.com","created_at":"2026-02-24T20:13:59.295317073Z","created_by":"Austin King","updated_at":"2026-02-24T20:13:59.295317073Z"}
{"id":"imagen-0dh","title":"Skip clippy --fix on pre-satisfied no-modification sessions","description":"Running clippy --fix when no files were modified is wasteful. Saves 1-2 turns on trivial sessions.","design":"Edit PROMPT.md: In step 4b (Code quality gates), add: If zero files were modified this session (pre-satisfied path), skip cargo clippy --fix --allow-dirty. Run only: cargo test --release and cargo fmt --check.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:01:07.114848847Z","created_by":"Austin King","updated_at":"2026-02-24T19:01:07.114848847Z"}
{"id":"imagen-1fs","title":"Create release.sh version bump and tag script","description":"Create scripts/release.sh adapted from ../blacksmith/scripts/release.sh. Changes from blacksmith:\n- Single Cargo.toml (no workspace member)\n- sed updates version in Cargo.toml, runs cargo check, commits + tags\n\nKeep from blacksmith: semver validation, clean tree check, tag creation.\n\nUsage: ./scripts/release.sh 0.1.0 \u0026\u0026 git push origin main v0.1.0\n\n## Acceptance Criteria\n- [ ] scripts/release.sh exists and is executable\n- [ ] Script validates semver format (e.g., 0.1.0)\n- [ ] Script checks for clean git tree (no uncommitted changes)\n- [ ] Script updates version in Cargo.toml via sed\n- [ ] Script runs cargo check to verify the version bump compiles\n- [ ] Script creates a git commit and tag (v0.1.0)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: bash -n scripts/release.sh\n- Expect: No syntax errors\n\n## Affected files\n- scripts/release.sh (new — adapted from ../blacksmith/scripts/release.sh)","status":"open","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:26.15540208Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.011441183Z","dependencies":[{"issue_id":"imagen-1fs","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:58.069299716Z","created_by":"Austin King"}]}
{"id":"imagen-1xm","title":"Wire replaying adapter to serve responses from cassettes","description":"Wire the replaying adapter so that when IMAGEN_REPLAY=\u003cpath\u003e is set, API calls are served from a pre-recorded cassette YAML file instead of hitting any live API. The scaffolding exists at src/adapters/replaying/image_generator.rs and src/cassette/replayer.rs. This bead connects them so replay serves deterministic responses. ServiceContext::replaying() should load the cassette and create a ReplayingImageGenerator.\n\n## Acceptance Criteria\n- [ ] ReplayingImageGenerator loads a cassette YAML and serves responses in recorded order\n- [ ] ServiceContext::replaying(path) constructs a ReplayingImageGenerator from cassette file\n- [ ] IMAGEN_REPLAY=\u003ccassette.yaml\u003e cargo run -- \"a cat\" produces identical output to the original recording\n- [ ] Exhausted cassette (more calls than recorded) returns a clear error\n- [ ] No network calls are made during replay\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: IMAGEN_REPLAY=test_fixtures/gemini_cat.cassette.yaml cargo run -- \"a cat\"\n- Expect: Image saved identically to original recording, no network activity\n\n## Affected files\n- src/adapters/replaying/image_generator.rs (modified)\n- src/context.rs (modified)\n- src/cassette/replayer.rs (modified — if adjustments needed)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:09.734203314Z","created_by":"Austin King","updated_at":"2026-02-24T18:58:42.178222794Z","closed_at":"2026-02-24T18:58:42.178222794Z","close_reason":"single-agent direct commit","dependencies":[{"issue_id":"imagen-1xm","depends_on_id":"imagen-vux","type":"blocks","created_at":"2026-02-24T18:43:57.891113874Z","created_by":"Austin King"}]}
{"id":"imagen-2vv","title":"Add parallel instruction to final Verification section in PROMPT.md","design":"Edit PROMPT.md in the '## Verification' section near the end of the file. Add after the existing command list: 'Run in two turns: (1) cargo test --release alone first. (2) Then in ONE parallel turn: cargo clippy --fix --allow-dirty AND cargo fmt --check (Rule A — independent once tests pass).' The current section lists all three commands without parallelism guidance, causing agents to run them in 3 sequential turns instead of 2.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:20:18.369423687Z","created_by":"Austin King","updated_at":"2026-02-24T19:20:18.369423687Z"}
{"id":"imagen-2yn","title":"Batch promote/dismiss improvement calls in parallel","design":"Edit PROMPT.md Improvement Recording section: add rule that all blacksmith improve promote and blacksmith improve dismiss calls must be emitted in ONE parallel turn when reviewing multiple improvements.","status":"open","priority":1,"issue_type":"chore","owner":"shout@ozten.com","created_at":"2026-02-24T20:05:31.25390476Z","created_by":"Austin King","updated_at":"2026-02-24T20:05:31.25390476Z"}
{"id":"imagen-326","title":"Fix broken session-start parallel example in PROMPT.md","design":"Edit PROMPT.md: On line 11, replace the session-start parallel example. Change 'bd ready + blacksmith progress show --bead-id \u003cid\u003e' to 'bd ready + Read MEMORY.md' since progress show requires the bead ID from bd ready (sequential dependency), but Read MEMORY.md is truly independent. On line 37 in Context Loading step 1, make the same fix and add step 1b: after bd ready returns the bead ID, run 'bd show \u003cid\u003e AND blacksmith progress show --bead-id \u003cid\u003e' in the SAME turn (these ARE independent of each other).","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:20:14.425671744Z","created_by":"Austin King","updated_at":"2026-02-24T19:20:14.425671744Z"}
{"id":"imagen-3by","title":"Use git add -f for .beads/ and .blacksmith/ in PROMPT.md commit guidance","design":"Edit PROMPT.md: In the analysis session commit step (or anywhere git add .beads/ .blacksmith/ is mentioned), change to 'git add -f .beads/ .blacksmith/' to force-add SQLite journal files (.db-shm, .db-wal) that are gitignored but must be committed. Add note explaining why: these files are SQLite WAL-mode journals that may be listed in .gitignore but are required to persist session state.","status":"open","priority":1,"issue_type":"chore","owner":"shout@ozten.com","created_at":"2026-02-24T20:14:07.716828953Z","created_by":"Austin King","updated_at":"2026-02-24T20:14:07.716828953Z"}
{"id":"imagen-3v0","title":"Create GitHub Actions CI and release workflows","description":"Create GitHub Actions workflows adapted from ../blacksmith/.github/workflows/:\n\n1. .github/workflows/release.yml (from ../blacksmith/.github/workflows/release.yml):\n   - 4-platform matrix: linux amd64/arm64, darwin amd64/arm64\n   - cross for linux ARM64\n   - Single binary package (imagen only, no workspace)\n   - SHA256 checksums + softprops/action-gh-release@v2\n   - latest tag update\n   - Archive format: imagen_{version}_{platform}.tar.gz\n\n2. .github/workflows/ci.yml (new):\n   - cargo fmt --all -- --check\n   - cargo clippy --all-targets --all-features -- -D warnings\n   - cargo test --all-targets --all-features\n   - Triggered on push to main and PRs\n\n## Acceptance Criteria\n- [ ] .github/workflows/release.yml exists with 4-platform matrix build\n- [ ] .github/workflows/ci.yml exists with fmt + clippy + test jobs\n- [ ] Release workflow triggers on tag push (v*)\n- [ ] CI workflow triggers on push to main and pull requests\n- [ ] YAML syntax is valid\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: python3 -c \"import yaml; yaml.safe_load(open('.github/workflows/ci.yml'))\" \u0026\u0026 python3 -c \"import yaml; yaml.safe_load(open('.github/workflows/release.yml'))\"\n- Expect: No YAML parse errors\n\n## Affected files\n- .github/workflows/release.yml (new — adapted from ../blacksmith/.github/workflows/release.yml)\n- .github/workflows/ci.yml (new)","status":"open","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:29.523055383Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.01223885Z","dependencies":[{"issue_id":"imagen-3v0","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:58.090971935Z","created_by":"Austin King"}]}
{"id":"imagen-48i","title":"Batch sub-bead bd create calls in parallel during decomposition","design":"Edit PROMPT.md Failed-Attempt Detection section step 2: add rule that all bd create sub-bead calls must be emitted in ONE parallel turn.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T20:05:35.307565095Z","created_by":"Austin King","updated_at":"2026-02-24T20:05:35.307565095Z"}
{"id":"imagen-5h1","title":"Wire recording adapter to save cassettes during live calls","description":"Wire the recording adapter so that when IMAGEN_REC=true is set, API calls flow through RecordingImageGenerator which wraps a live adapter, forwards the call, and saves the request/response pair to a YAML cassette file. The scaffolding exists at src/adapters/recording/image_generator.rs and src/cassette/recorder.rs. This bead connects them so recording actually captures real interactions. ServiceContext::recording() should wrap the live adapter with the recording layer.\n\n## Acceptance Criteria\n- [ ] RecordingImageGenerator wraps a live adapter and forwards generate() calls\n- [ ] After each generate() call, the request and response are recorded via CassetteRecorder\n- [ ] ServiceContext::recording() constructs a RecordingImageGenerator wrapping the live adapter\n- [ ] IMAGEN_REC=true cargo run -- \"a cat\" produces a cassette YAML file in .imagen/cassettes/\n- [ ] The cassette YAML contains the full request and base64-encoded response\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: IMAGEN_REC=true GEMINI_API_KEY=\u003ckey\u003e cargo run -- \"a cat\"\n- Expect: Image saved AND cassette YAML file created in .imagen/cassettes/\u003ctimestamp\u003e/\n\n## Affected files\n- src/adapters/recording/image_generator.rs (modified)\n- src/context.rs (modified)\n- src/cassette/recorder.rs (modified — if adjustments needed)","status":"open","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:06.837804636Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.006954056Z","dependencies":[{"issue_id":"imagen-5h1","depends_on_id":"imagen-vux","type":"blocks","created_at":"2026-02-24T18:43:57.86805507Z","created_by":"Austin King"}]}
{"id":"imagen-5w7","title":"Fix Rule A: replace wrong cargo clippy+test parallel example with correct integration-check example","design":"Edit PROMPT.md line 14: Replace '- Session end: Bash(cargo clippy --fix --allow-dirty) + Bash(cargo test --release) → ONE turn (if they dont depend on each other output)' with '- Integration check (step 4c): Bash(grep -r changed_fn src/) + Bash(grep -r changed_struct tests/) → ONE turn (independent search calls are always safe to parallelize)'. This removes a misleading example that causes agents to distrust ALL parallel examples when they detect this one is wrong.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:25:37.229314361Z","created_by":"Austin King","updated_at":"2026-02-24T19:25:37.229314361Z"}
{"id":"imagen-6jy","title":"Record initial cassettes for Gemini and OpenAI","description":"MANUAL STEP requiring real API keys. The agentic harness must be stopped so the user can configure keys.\n\n1. Ensure Phases 1+2 produce a working imagen binary that can record\n2. touch STOP to stop the agentic harness\n3. User creates ~/.config/imagen/config.toml with API keys:\n   [keys]\n   gemini = \"your-gemini-api-key\"\n   openai = \"your-openai-api-key\"\n4. User records Gemini cassette: IMAGEN_REC=true cargo run -- \"a cat\"\n5. User records OpenAI cassette: IMAGEN_REC=true cargo run -- -m gpt-1 \"a cat\"\n6. Copy recorded cassettes to test_fixtures/:\n   - test_fixtures/gemini_cat.cassette.yaml\n   - test_fixtures/openai_cat.cassette.yaml\n\nAfter this step, all subsequent automated tests replay from these cassettes. No test ever hits a live API.\n\n## Acceptance Criteria\n- [ ] test_fixtures/gemini_cat.cassette.yaml exists with real recorded Gemini interaction\n- [ ] test_fixtures/openai_cat.cassette.yaml exists with real recorded OpenAI interaction\n- [ ] IMAGEN_REPLAY=test_fixtures/gemini_cat.cassette.yaml cargo run -- \"a cat\" replays successfully\n- [ ] IMAGEN_REPLAY=test_fixtures/openai_cat.cassette.yaml cargo run -- -m gpt-1 \"a cat\" replays successfully\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: IMAGEN_REPLAY=test_fixtures/gemini_cat.cassette.yaml cargo run -- \"a cat\"\n- Expect: Image saved from cassette replay, no live API call\n\n## Affected files\n- test_fixtures/gemini_cat.cassette.yaml (new)\n- test_fixtures/openai_cat.cassette.yaml (new)","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:13.300344886Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.008513099Z","dependencies":[{"issue_id":"imagen-6jy","depends_on_id":"imagen-5h1","type":"blocks","created_at":"2026-02-24T18:43:57.916055262Z","created_by":"Austin King"},{"issue_id":"imagen-6jy","depends_on_id":"imagen-1xm","type":"blocks","created_at":"2026-02-24T18:43:57.938925107Z","created_by":"Austin King"}]}
{"id":"imagen-6pe","title":"Add README and developer documentation","description":"Create README.md and developer documentation. README should include: install via curl, usage examples, model table, configuration, and links to detailed docs. Adapt install section pattern from ../blacksmith/README.md.\n\nDocumentation files:\n- docs/record-replay.md: How to record and replay cassette sessions (content outlined in PRD)\n- docs/development.md: Build, test, lint, coverage, CI instructions\n- docs/architecture.md: Hexagonal architecture overview with port/adapter diagram\n\n## Acceptance Criteria\n- [ ] README.md exists with install, usage, model table, config sections\n- [ ] Install section shows: curl -fsSL https://raw.githubusercontent.com/ozten/imagen/main/scripts/install.sh | bash\n- [ ] docs/record-replay.md documents recording and replaying sessions\n- [ ] docs/development.md documents build, test, lint, coverage commands\n- [ ] docs/architecture.md describes hexagonal architecture\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: ls README.md docs/record-replay.md docs/development.md docs/architecture.md\n- Expect: All four files exist\n\n## Affected files\n- README.md (new)\n- docs/record-replay.md (new)\n- docs/development.md (new)\n- docs/architecture.md (new)","status":"open","priority":3,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:35.554942226Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.015040809Z","dependencies":[{"issue_id":"imagen-6pe","depends_on_id":"imagen-sxh","type":"blocks","created_at":"2026-02-24T18:43:58.11553674Z","created_by":"Austin King"},{"issue_id":"imagen-6pe","depends_on_id":"imagen-lko","type":"blocks","created_at":"2026-02-24T18:43:58.14123317Z","created_by":"Austin King"},{"issue_id":"imagen-6pe","depends_on_id":"imagen-1fs","type":"blocks","created_at":"2026-02-24T18:43:58.168507892Z","created_by":"Austin King"},{"issue_id":"imagen-6pe","depends_on_id":"imagen-3v0","type":"blocks","created_at":"2026-02-24T18:43:58.191868362Z","created_by":"Austin King"}]}
{"id":"imagen-6x0","title":"Batch all implementation file reads in ONE parallel turn in Step 3","design":"Edit PROMPT.md Step 3 (Implement): after the bullet 'Only read files you need to modify — architecture is in MEMORY.md', add a new bullet: '**Batch all file reads in ONE turn (Rule A)**: From the bead description, identify ALL source files you will need upfront. Emit ALL Read calls in a SINGLE turn — never read files one at a time sequentially.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:30:52.139216227Z","created_by":"Austin King","updated_at":"2026-02-24T19:30:52.139216227Z"}
{"id":"imagen-76j","title":"Batch parallel calls in verify step 4a","description":"Apply improvement R5: update PROMPT.md step 4a to require parallel Bash calls for independent verify commands","design":"Edit PROMPT.md: In step 4a (Bead-specific verification), after 'execute those exact steps', add: 'If the ## Verify section lists multiple independent commands (e.g. cargo test AND a curl check), emit all of them as parallel Bash calls in ONE turn per Rule A — do not run them sequentially.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:14:51.730550966Z","created_by":"Austin King","updated_at":"2026-02-24T19:14:51.730550966Z"}
{"id":"imagen-7gb","title":"Fix step 4b: mark cargo clippy --fix and fmt --check as sequential, not parallel","design":"Edit PROMPT.md lines 86-90: Change the comment '# Then in ONE turn with TWO parallel Bash calls:' to '# Then sequentially (clippy modifies source files that fmt reads, so these cannot be parallelized):'. This prevents agents from attempting to parallelize two commands that share file-write/file-read dependencies, which could produce incorrect fmt results.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:25:41.058667056Z","created_by":"Austin King","updated_at":"2026-02-24T19:25:41.058667056Z"}
{"id":"imagen-8ad","title":"Add code coverage with cargo-llvm-cov targeting 80%","description":"Set up code coverage measurement using cargo-llvm-cov. Target 80% coverage excluding main.rs and live adapters (src/adapters/live/). Add a script or Makefile target to run coverage. Ensure the CI workflow will be able to check coverage as a quality gate.\n\n## Acceptance Criteria\n- [ ] cargo llvm-cov runs and produces a coverage report\n- [ ] Coverage excludes main.rs and src/adapters/live/ (these require real API keys)\n- [ ] Coverage is \u003e= 80% on the included source files\n- [ ] A script or command documents how to run coverage (e.g., scripts/coverage.sh or Makefile target)\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: cargo llvm-cov --ignore-filename-regex \"(main|adapters/live)\" -- --all-targets\n- Expect: Coverage report showing \u003e= 80% for included files\n\n## Affected files\n- scripts/coverage.sh (new) or Makefile (new)\n- Cargo.toml (modified — if dev-dependency needed)","status":"open","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:19.817685594Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.009925391Z","dependencies":[{"issue_id":"imagen-8ad","depends_on_id":"imagen-sxh","type":"blocks","created_at":"2026-02-24T18:43:57.988372216Z","created_by":"Austin King"}]}
{"id":"imagen-8yp","title":"Add Bash+python3 session file parsing note to PROMPT.md","design":"Edit PROMPT.md ## Important section or ## Context Loading: add note that session .jsonl files must be read with Bash+python3 (never Read tool which fails \u003e25000 tokens). Add example: python3 -c 'import json; lines=[json.loads(l) for l in open(\".blacksmith/sessions/N.jsonl\")]'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T20:00:22.299754424Z","created_by":"Austin King","updated_at":"2026-02-24T20:00:22.299754424Z"}
{"id":"imagen-9rw","title":"Add synthesis anti-pattern example to Rule B in PROMPT.md","design":"Edit PROMPT.md Rule B section: After existing WRONG/RIGHT example, add: 'WRONG: \"Now I have enough data. Let me synthesize my findings.\" (text only, no tool call) → action in next turn. RIGHT: Synthesize findings AND emit the first resulting tool call in ONE message. Analysis/thinking never justifies a text-only turn.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:47:58.669229901Z","created_by":"Austin King","updated_at":"2026-02-24T19:47:58.669229901Z"}
{"id":"imagen-atu","title":"Add turn-10 parallel checkpoint to PROMPT.md Turn Budget section","design":"Edit PROMPT.md: In the Turn Budget (R1) section, after the '- Turns 1-55: Normal implementation.' bullet, add a new bullet: '- **Turn 10 checkpoint**: Count your parallel turns (turns where you emitted 2+ tool calls in one message). If count is 0, you are violating Rule A — re-read it and make your next turn parallel. A session that reaches turn 10 with zero parallel calls almost always finishes that way.' This creates an early self-correction trigger before too many sequential turns accumulate.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:25:45.187028089Z","created_by":"Austin King","updated_at":"2026-02-24T19:25:45.187028089Z"}
{"id":"imagen-b7n","title":"Wire Gemini live adapter to make real API calls","description":"Complete the Gemini live adapter so it makes real API calls. The skeleton exists at src/adapters/live/gemini.rs with the struct and trait impl stubbed out. Wire it to POST to https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent with x-goog-api-key header auth. Parse candidates[].content.parts[].inline_data for base64 JPEG image data. Gemini always returns JPEG regardless of requested format. See PRD \"External References\" section for API details.\n\n## Acceptance Criteria\n- [ ] GeminiAdapter::generate() sends correct HTTP POST with JSON body containing prompt, aspect_ratio, and responseModalities: [\"IMAGE\"]\n- [ ] Response parsing extracts base64 image data from candidates[].content.parts[].inline_data\n- [ ] API key is read from Config::gemini_key() (env var \u003e config file)\n- [ ] Missing API key returns ImageError::MissingApiKey\n- [ ] HTTP errors return ImageError::Api with status code and message\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: GEMINI_API_KEY=test cargo check\n- Expect: Compiles without errors. Manual live test: GEMINI_API_KEY=\u003creal-key\u003e cargo run -- \"a cat\"\n\n## Affected files\n- src/adapters/live/gemini.rs (modified)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:40:55.935092782Z","created_by":"Austin King","updated_at":"2026-02-24T18:54:34.852058723Z","closed_at":"2026-02-24T18:54:34.852058723Z","close_reason":"single-agent direct commit","dependencies":[{"issue_id":"imagen-b7n","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:57.769398102Z","created_by":"Austin King"}]}
{"id":"imagen-c2l","title":"Add Rule A parallel reminder to Improvement Recording section","design":"Edit PROMPT.md ## Improvement Recording section: add a bolded Rule A reminder before 'Record improvements as you work' line. Text: 'Rule A applies here too: When filing 2+ improvements in one session, emit ALL blacksmith improve add calls in ONE parallel turn — they are independent of each other.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:54:32.380075277Z","created_by":"Austin King","updated_at":"2026-02-24T19:54:32.380075277Z"}
{"id":"imagen-ciq","title":"Add failed-attempt finish sequence to PROMPT.md","design":"Edit PROMPT.md under 'Marking a Failed Attempt': add explicit instruction that after marking failure, always call blacksmith progress add then blacksmith finish (not just exit). This prevents sessions ending without proper git sync and state cleanup.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:43:18.772438818Z","created_by":"Austin King","updated_at":"2026-02-24T19:43:18.772438818Z"}
{"id":"imagen-e9g","title":"Merge Claim and Understand steps into one parallel turn after bd ready","design":"Edit PROMPT.md Steps 1-2: Replace the two separate steps with a single instruction: After bd ready resolves the bead ID, emit in ONE turn: `bd update \u003cid\u003e --status in_progress` + `bd show \u003cid\u003e` + `blacksmith progress show --bead-id \u003cid\u003e` (three parallel calls). This merges the sequential Claim and Understand steps into one parallel turn.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:30:56.238007498Z","created_by":"Austin King","updated_at":"2026-02-24T19:30:56.238007498Z"}
{"id":"imagen-f2g","title":"Add Rule B pre-creation narration anti-pattern to PROMPT.md Improvement Recording section","design":"Edit PROMPT.md ## Improvement Recording section: add anti-pattern example showing WRONG (standalone 'Now creating beads...' narration turn) vs RIGHT (narration + first bd create call in same turn). Reinforces Rule B for improvement/bead creation workflow.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T20:00:25.753063786Z","created_by":"Austin King","updated_at":"2026-02-24T20:00:25.753063786Z"}
{"id":"imagen-f9z","title":"Enforce ## Verify section on pre-satisfied beads","description":"Process improvement to prevent bead sessions that claim done without running verify section. Seen when imagen-1xm session 5 claimed satisfied but missed a test fixture requirement, requiring session 6 to fix.","design":"Edit PROMPT.md: In step 3 (Implement) add a CRITICAL note after 'Complete the task fully': If acceptance criteria appear already satisfied by prior work, skip to step 4 but run ALL Verify commands before recording progress. Never write a progress entry claiming done until verify section passes.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:00:59.125568362Z","created_by":"Austin King","updated_at":"2026-02-24T19:00:59.125568362Z"}
{"id":"imagen-g6c","title":"Fix stale lint:fix and analyze commands in Turn Budget section","design":"Edit PROMPT.md ## Turn Budget section: find the line containing 'lint:fix' and 'analyze' (in the Turns 56-65 description) and replace it with: 'Run `cargo test --release`, then call `blacksmith finish` which handles lint and format automatically.' The commands lint:fix and analyze do not exist in this Rust project.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:35:43.05313487Z","created_by":"Austin King","updated_at":"2026-02-24T19:35:43.05313487Z"}
{"id":"imagen-gzv","title":"Wire config defaults to override CLI defaults","description":"Wire config.defaults into main.rs so that config file default values override CLI defaults when the user hasn't explicitly set a flag. Currently DefaultsConfig fields have #[allow(dead_code)] annotations. Remove those and use config.defaults to set effective values for model, aspect_ratio, size, quality, and format when the CLI arg matches its default (meaning the user didn't override it).\n\n## Acceptance Criteria\n- [ ] Config file [defaults] section values are used when CLI flags are at their defaults\n- [ ] Explicit CLI flags always override config defaults\n- [ ] #[allow(dead_code)] removed from DefaultsConfig and its fields\n- [ ] Unit test: config default model overrides CLI default \"nano-banana\"\n- [ ] Unit test: explicit -m flag overrides config default\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + new tests)\n\n## Verify\n- Run: Create a config.toml with [defaults] model = \"gpt-1\", then cargo run -- \"test\" should use gpt-1\n- Expect: Verbose output shows model resolved from config default\n\n## Affected files\n- src/main.rs (modified)\n- src/config.rs (modified — remove dead_code allows)","status":"open","priority":2,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:32.434120109Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.012917892Z","dependencies":[{"issue_id":"imagen-gzv","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:58.012187478Z","created_by":"Austin King"}]}
{"id":"imagen-jdc","title":"Initialize git repository and create initial commit","description":"Initialize a git repository for the imagen project at ~/imagen/. All Phase 1 scaffold code already exists and compiles. This bead creates the repo, adds a .gitignore, and makes the initial commit.\n\n## Acceptance Criteria\n- [ ] ~/imagen/ is a git repository\n- [ ] .gitignore excludes target/, *.swp, .env, and IDE files\n- [ ] Initial commit contains all Phase 1 source files\n- [ ] cargo build succeeds from a clean checkout\n- [ ] cargo test passes (51 existing tests)\n\n## Verify\n- Run: cd ~/imagen \u0026\u0026 git log --oneline -1\n- Expect: Initial commit with all Phase 1 scaffold files\n\n## Affected files\n- .gitignore (new)","status":"closed","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:38.783272114Z","created_by":"Austin King","updated_at":"2026-02-24T18:50:49.628459977Z","closed_at":"2026-02-24T18:50:49.628459977Z","close_reason":"single-agent direct commit"}
{"id":"imagen-ko4","title":"Add comprehensive python3 analysis script pattern to PROMPT.md Analysis Session section","design":"Edit PROMPT.md Analysis Session Workflow section (imagen-03l adds this section): Add rule that all session metrics must be extracted in ONE comprehensive python3 Bash call. Include example script template that computes: tool_call counts, parallel turn counts, narration-only turns, tool name breakdown, thinking-only turn count — all in a single pass over the .jsonl file. Add explicit prohibition: 'Never run 5+ separate python3 scripts on the same session .jsonl file.'","status":"open","priority":1,"issue_type":"chore","owner":"shout@ozten.com","created_at":"2026-02-24T20:14:03.651907735Z","created_by":"Austin King","updated_at":"2026-02-24T20:14:03.651907735Z"}
{"id":"imagen-l17","title":"Add pre-satisfied fast path step to Execution Protocol","description":"Agents waste turns reading and exploring when bead is already done. Need explicit documented fast path to jump from claim to verify.","design":"Edit PROMPT.md: After step 2 (Understand) in Execution Protocol, add step 2b: Pre-satisfied check. If all acceptance criteria appear already met by prior sessions work, take the PRE-SATISFIED PATH: do NOT read source files, do NOT write code, skip step 3 entirely and jump to step 4a (Verify section).","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:01:07.089091142Z","created_by":"Austin King","updated_at":"2026-02-24T19:01:07.089091142Z"}
{"id":"imagen-lbg","title":"Include actual error text in failed-attempt notes","description":"Apply improvement R6: update PROMPT.md failed-attempt note format to include actual error text for better future-session diagnosis","design":"Edit PROMPT.md: In '### Marking a Failed Attempt', change the bd update example to show: '--notes=\"[FAILED-ATTEMPT] \u003cYYYY-MM-DD\u003e \u003creason\u003e: \u003cfirst 2 lines of the actual error\u003e\"'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:14:54.931050226Z","created_by":"Austin King","updated_at":"2026-02-24T19:14:54.931050226Z"}
{"id":"imagen-lko","title":"Create curl-installable install.sh script","description":"Create scripts/install.sh adapted from ../blacksmith/scripts/install.sh. Changes from blacksmith:\n- REPO=\"ozten/blacksmith\" -\u003e REPO=\"ozten/imagen\"\n- BLACKSMITH_VERSION env var -\u003e IMAGEN_VERSION\n- Remove dual binary handling (only \"imagen\", no \"-ui\")\n- Archive naming: imagen_{version}_{platform}.tar.gz\n\nKeep from blacksmith: platform detection (linux_amd64, linux_arm64, darwin_amd64, darwin_arm64), smart install dir (/usr/local/bin -\u003e fallback ~/.local/bin), macOS code-signing, curl/wget fallback.\n\n## Acceptance Criteria\n- [ ] scripts/install.sh exists and is executable\n- [ ] Script detects platform correctly (linux/darwin, amd64/arm64)\n- [ ] Script downloads from https://github.com/ozten/imagen/releases\n- [ ] IMAGEN_VERSION env var allows pinning a specific version\n- [ ] Fallback install to ~/.local/bin if /usr/local/bin is not writable\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: bash -n scripts/install.sh\n- Expect: No syntax errors. Manual test: curl -fsSL .../install.sh | bash installs the binary\n\n## Affected files\n- scripts/install.sh (new — adapted from ../blacksmith/scripts/install.sh)","status":"open","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:23.034875447Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.010739058Z","dependencies":[{"issue_id":"imagen-lko","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:58.037166741Z","created_by":"Austin King"}]}
{"id":"imagen-n3n","title":"Add prohibited standalone turns list to PROMPT.md Step 3","design":"Edit PROMPT.md Step 3 (Implement): add a 'Prohibited single-tool turns' block before the first bullet, listing: (1) do not run cargo check alone (cargo test already compiles), (2) do not run ls/find/Glob for directory exploration (use MEMORY.md). Evidence: session 4 turn 13 ran cargo check then cargo test, session 4 turn 14 ran ls test_fixtures — two wasted turns.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:43:24.232739681Z","created_by":"Austin King","updated_at":"2026-02-24T19:43:24.232739681Z"}
{"id":"imagen-ptp","title":"Always include --design flag in bd create calls","design":"Edit PROMPT.md Failed-Attempt Detection section step 2: require --design flag in bd create calls to prevent context-free beads and warnings.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T20:05:35.335932421Z","created_by":"Austin King","updated_at":"2026-02-24T20:05:35.335932421Z"}
{"id":"imagen-r22","title":"Add parallel test-filter pattern to Rule A mandatory list in PROMPT.md","design":"Edit PROMPT.md Rule A mandatory parallel patterns list: after the '- Multiple greps' bullet, add a new bullet: '- Running independent test subsets: cargo test --release --filter suite_a + cargo test --release --filter suite_b → ONE turn'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:54:38.146458811Z","created_by":"Austin King","updated_at":"2026-02-24T19:54:38.146458811Z"}
{"id":"imagen-ru8","title":"Add context-loading step 1b to PROMPT.md","design":"Edit PROMPT.md under '## Context Loading'. After step 1, add step 1b: 'Once bd ready returns the bead ID, run bd show \u003cid\u003e AND blacksmith progress show --bead-id \u003cid\u003e in the SAME turn (Rule A — these are independent). This is the second mandatory parallel pattern of every session.' This creates a concrete two-step bootstrap giving agents two forced parallel opportunities at session start.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:20:21.355403837Z","created_by":"Austin King","updated_at":"2026-02-24T19:20:21.355403837Z"}
{"id":"imagen-rv2","title":"Add valid bd create type values note to PROMPT.md Improvement Recording section","design":"Edit PROMPT.md ## Improvement Recording section: add after bd create example 'Note: valid --type values: task, bug, feature. Do NOT use --type process (invalid, will error).'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T20:00:22.298959008Z","created_by":"Austin King","updated_at":"2026-02-24T20:00:22.298959008Z"}
{"id":"imagen-s6a","title":"Add Turn 1 Rule to PROMPT.md: first message must include bd ready tool call","design":"Edit PROMPT.md: Add immediately before the '### Rule A: ALWAYS batch...' heading: a new rule block titled '**Turn 1 Rule**' stating that the first assistant message MUST contain a tool call (bd ready + optionally Read MEMORY.md), and that any text-only turn 1 is an immediate Rule B violation. Evidence: session 0 Turn 1 was text-only, establishing a narration-first pattern that persisted all session.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:43:14.664338877Z","created_by":"Austin King","updated_at":"2026-02-24T19:43:14.664338877Z"}
{"id":"imagen-sxh","title":"Add integration tests using cassette replay","description":"Add integration tests that exercise the full CLI flow using cassette replay. CRITICAL: No test may ever hit a live API endpoint. All integration tests use IMAGEN_REPLAY with pre-recorded cassettes from test_fixtures/. Tests go in tests/cli.rs (CLI arg validation, no network) and tests/record_replay.rs (full cassette round-trip).\n\nTest scenarios from PRD:\n1. Gemini happy path: replay Gemini cassette, verify image file output\n2. OpenAI happy path: replay OpenAI cassette, verify image file output\n3. CLI arg validation: invalid model, invalid aspect ratio, missing prompt\n4. Format conversion: --format png with Gemini cassette converts JPEG to PNG\n5. Auto-filename: verify kebab-case naming with timestamp\n\n## Acceptance Criteria\n- [ ] tests/cli.rs has CLI arg parsing and validation tests (no network)\n- [ ] tests/record_replay.rs has cassette replay integration tests\n- [ ] All tests pass with NO API keys set (using IMAGEN_REPLAY)\n- [ ] At least 5 integration test cases covering the scenarios listed above\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing + new tests)\n\n## Verify\n- Run: unset GEMINI_API_KEY \u0026\u0026 unset OPENAI_API_KEY \u0026\u0026 cargo test --all-targets\n- Expect: All tests pass with zero network calls\n\n## Affected files\n- tests/cli.rs (new)\n- tests/record_replay.rs (new)","status":"open","priority":2,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:16.569889988Z","created_by":"Austin King","updated_at":"2026-02-24T18:46:39.009205057Z","dependencies":[{"issue_id":"imagen-sxh","depends_on_id":"imagen-6jy","type":"blocks","created_at":"2026-02-24T18:43:57.962749036Z","created_by":"Austin King"}]}
{"id":"imagen-t3q","title":"Add Rule B inline reminders at Steps 3, 4, 5 to prevent narration-only turns","design":"Edit PROMPT.md: Add '(Rule B: every narration message MUST include a tool call)' as a parenthetical to the Step 3 Implement header, Step 4 Verify header, and Step 5 Finish header. These three transition points account for 5-8 wasted text-only turns per coding session.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:30:59.2031753Z","created_by":"Austin King","updated_at":"2026-02-24T19:30:59.2031753Z"}
{"id":"imagen-ti1","title":"Add Rule A look-ahead scan instruction to PROMPT.md","design":"Edit PROMPT.md Rule A section: after the mandatory parallel patterns list (after 'Reading multiple related files' bullet), add: 'Look-ahead scan: Before emitting ANY single tool call, ask: Will I need another independent call in the next 2 turns? If yes, emit BOTH now in one turn. Never defer an independent call you already know you need.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:54:35.338705619Z","created_by":"Austin King","updated_at":"2026-02-24T19:54:35.338705619Z"}
{"id":"imagen-u0k","title":"Handle missing MEMORY.md in Context Loading step","description":"Process improvement to prevent wasted turns when MEMORY.md does not exist. Agents currently try to read MEMORY.md, get a file-not-found error, then fall back to ls exploration, wasting 2 turns per session in early-stage projects.","design":"Edit PROMPT.md: In ## Context Loading section, add after 'The project architecture is documented in MEMORY.md — do NOT re-explore the codebase.': '(If MEMORY.md does not exist, skip it — do NOT fall back to ls, explore agents, or re-reading known files. Proceed directly to step 1.)'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:05:43.616601689Z","created_by":"Austin King","updated_at":"2026-02-24T19:05:43.616601689Z"}
{"id":"imagen-vux","title":"Wire ServiceContext live mode to dispatch to correct adapter","description":"Wire ServiceContext::live() to construct the correct live adapter (GeminiAdapter or OpenAiAdapter) based on the detected Provider enum. The context.rs file already has live(), recording(), and replaying() constructors scaffolded. Ensure live() reads the API key from Config, creates the appropriate adapter, and boxes it as a dyn ImageGenerator. The main.rs run() function already calls ServiceContext methods — this bead makes them actually work with real adapters.\n\n## Acceptance Criteria\n- [x] ServiceContext::live(Provider::Gemini, \u0026config) creates a GeminiAdapter with the Gemini API key\n- [x] ServiceContext::live(Provider::OpenAi, \u0026config) creates an OpenAiAdapter with the OpenAI API key\n- [x] Missing API key for the selected provider returns ImageError::MissingApiKey\n- [x] Full CLI flow works: cargo run -- \"a cat\" (with API key set) generates and saves an image\n- [x] cargo check passes with no new errors\n- [x] cargo test passes (all existing tests)\n\n## Verify\n- Run: cargo check --release\n- Expect: Finished with no errors\n\n## Affected files\n- src/context.rs (modified)\n- src/main.rs (modified — if any wiring adjustments needed)","notes":"## Verify\n- Run: cargo check --release\n- Expect: No errors or warnings","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:03.45177579Z","created_by":"Austin King","updated_at":"2026-02-24T18:55:51.479372504Z","closed_at":"2026-02-24T18:55:51.479372504Z","close_reason":"single-agent direct commit","dependencies":[{"issue_id":"imagen-vux","depends_on_id":"imagen-b7n","type":"blocks","created_at":"2026-02-24T18:43:57.820024087Z","created_by":"Austin King"},{"issue_id":"imagen-vux","depends_on_id":"imagen-xjv","type":"blocks","created_at":"2026-02-24T18:43:57.843883099Z","created_by":"Austin King"}]}
{"id":"imagen-xjv","title":"Wire OpenAI live adapter to make real API calls","description":"Complete the OpenAI live adapter so it makes real API calls. The skeleton exists at src/adapters/live/openai.rs with the struct and trait impl stubbed out. Wire it to POST to https://api.openai.com/v1/images/generations with Bearer token auth. Use aspect_ratio_to_openai_size() from params.rs to translate aspect ratios to pixel dimensions. Parse data[].b64_json for base64 image data. OpenAI only accepts sizes: 1024x1024, 1536x1024, 1024x1536, auto. For 2K/4K size requests, use \"auto\" and log a note in verbose mode. See PRD \"Parameter Translation\" and \"External References\" sections.\n\n## Acceptance Criteria\n- [ ] OpenAiAdapter::generate() sends correct HTTP POST with model, prompt, size (translated from aspect_ratio), quality, output_format, and n fields\n- [ ] Size translation uses aspect_ratio_to_openai_size() for 1K; uses \"auto\" for 2K/4K\n- [ ] Response parsing extracts base64 image data from data[].b64_json\n- [ ] API key is read from Config::openai_key() (env var \u003e config file)\n- [ ] Missing API key returns ImageError::MissingApiKey\n- [ ] HTTP errors return ImageError::Api with status code and message\n- [ ] cargo check passes with no new errors\n- [ ] cargo test passes (all existing tests)\n\n## Verify\n- Run: OPENAI_API_KEY=test cargo check\n- Expect: Compiles without errors. Manual live test: OPENAI_API_KEY=\u003creal-key\u003e cargo run -- -m gpt-1 \"a cat\"\n\n## Affected files\n- src/adapters/live/openai.rs (modified)","status":"closed","priority":1,"issue_type":"feature","owner":"shout@ozten.com","created_at":"2026-02-24T18:41:00.134233728Z","created_by":"Austin King","updated_at":"2026-02-24T18:52:54.242406361Z","closed_at":"2026-02-24T18:52:54.242406361Z","close_reason":"single-agent direct commit","dependencies":[{"issue_id":"imagen-xjv","depends_on_id":"imagen-jdc","type":"blocks","created_at":"2026-02-24T18:43:57.793741698Z","created_by":"Austin King"}]}
{"id":"imagen-yzh","title":"Add Rule D to PROMPT.md: prohibit iterative re-reads of same file","design":"Edit PROMPT.md: After Rule B (NEVER emit text-only turn), add Rule D: 'Rule D: NEVER re-read the same file multiple times with incremental script variations. When extracting data from any file, write ONE comprehensive script that retrieves ALL needed information in a single Bash call. Each re-read of the same file costs one wasted turn.'","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:47:56.008277042Z","created_by":"Austin King","updated_at":"2026-02-24T19:47:56.008277042Z"}
{"id":"imagen-zks","title":"Remove redundant final Verification section from PROMPT.md","design":"Edit PROMPT.md: Remove the '## Verification' section at the bottom of the file (the block starting with 'Before closing a task, run these commands and ensure they pass:' listing cargo test, cargo clippy, cargo fmt). Replace with a single line note: '## Verification - All quality gates are run automatically by blacksmith finish. Do not run them manually — Step 4b and blacksmith finish handle this.' This eliminates triple-execution of quality gates per session.","status":"open","priority":1,"issue_type":"task","owner":"shout@ozten.com","created_at":"2026-02-24T19:35:39.70433237Z","created_by":"Austin King","updated_at":"2026-02-24T19:35:39.70433237Z"}
